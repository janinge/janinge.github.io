var _createClass=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.Smartcar=t()}(this,function(){"use strict";var e=function(){function a(e){var i=this;_classCallCheck(this,a),a._validateConstructorOptions(e),this.clientId=e.clientId,this.redirectUri=e.redirectUri,this.scope=e.scope,this.onComplete=e.onComplete,this.mode=!0===e.testMode?"test":"live",this.responseType="code",this.messageHandler=function(e){if(i.redirectUri.startsWith(e.origin)){var t,r,o=e.data||{};if("SmartcarAuthMessage"===o.name)if(i.onComplete){var n=(t=o.error,r=o.errorDescription,t?"access_denied"===t?new a.AccessDenied(r):new Error("Unexpected error: "+t+" - "+r):null);i.onComplete(n,o.code,o.state)}}},window.addEventListener("message",this.messageHandler)}return _createClass(a,[{key:"getAuthUrl",value:function(e){e=e||{};var t="";if(t+="https://connect.smartcar.com/oauth/authorize",t+="?response_type="+this.responseType,t+="&client_id="+this.clientId,t+="&redirect_uri="+encodeURIComponent(this.redirectUri),t+="&approval_prompt="+(e.forcePrompt||!1?"force":"auto"),this.scope&&(t+="&scope="+encodeURIComponent(this.scope.join(" "))),t+="&mode="+this.mode,e.state&&(t+="&state="+e.state),e.vehicleInfo){var r=!0,o=!1,n=void 0;try{for(var i,a=["make"][Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;s in e.vehicleInfo&&(t+="&"+s+"="+encodeURIComponent(e.vehicleInfo[s]))}}catch(e){o=!0,n=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw n}}}return t}},{key:"openDialog",value:function(e){var t=this.getAuthUrl(e),r=a._getWindowOptions();window.open(t,"Connect your car",r)}},{key:"addClickHandler",value:function(e){var t=this,r=e.id,o={state:e.state,forcePrompt:e.forcePrompt},n=document.getElementById(r);if(!n)throw new Error("Could not add click handler: element with id '"+r+"' was not found.");n.addEventListener("click",function(){return t.openDialog(o),!1})}}],[{key:"_validateConstructorOptions",value:function(e){if(a._hasBeenInstantiated)throw new Error("Smartcar has already been instantiated in the window. Only one instance of Smartcar can be defined.");if(a._hasBeenInstantiated=!0,!e.clientId)throw new TypeError("A client ID option must be provided");if(!e.redirectUri)throw new TypeError("A redirect URI option must be provided");if(e.redirectUri.startsWith("https://javascript-sdk.smartcar.com")&&(!e.onComplete||e.onComplete.length<2))throw new Error("When using Smartcar's CDN redirect an onComplete function with at least 2 parameters (error & code) is required to handle completion of authorization flow")}},{key:"_getWindowOptions",value:function(){var e=430,t=500,r=(window.outerWidth-e)/2,o=(window.outerHeight-t)/8,n="";return n+="top="+(window.screenY+o)+",",n+="left="+(window.screenX+r)+",",n+="width="+e+",",n+="height="+t+","}}]),a}();return e.AccessDenied=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.name="AccessDenied",t}return _inherits(r,Error),r}(),e});